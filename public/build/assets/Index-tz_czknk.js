import{i as d,j as t,B as C,y as g}from"./app-C_DxjwWY.js";import{B as p,D,I as w,a as P,P as j}from"./DataTable-q0nUR4_e.js";import{P as R,T as _}from"./PageHeader-OnnDhg3C.js";import{b as T,A as z,a as y,T as c,M as m}from"./AppLayout-HsdZrY7g.js";import{T as n}from"./Tabs-HDMTV0PT.js";import{I as M,a as E}from"./IconCalendarX-Jv4cPk1F.js";import{L as h}from"./List-MY51wW15.js";import"./AccordionChevron-TzXOvNPl.js";import"./Select-_gJN92p0.js";import"./Flex-1RADBffJ.js";import"./TextInput-C56idysm.js";import"./Alert-nAAyeiA1.js";import"./Title-gs-8KFVt.js";import"./dayjs.min-wYxT7LQk.js";import"./clamp-153t9aX1.js";import"./get-safe-id-KjcUIRmk.js";var B=T("route","IconRoute",[["path",{d:"M3 19a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M19 7a2 2 0 1 0 0 -4a2 2 0 0 0 0 4z",key:"svg-1"}],["path",{d:"M11 19h5.5a3.5 3.5 0 0 0 0 -7h-8a3.5 3.5 0 0 1 0 -7h4.5",key:"svg-2"}]]);const U=s=>{console.log(s);const[b,I]=d.useState(s.orders);d.useEffect(()=>{(async()=>{const r=[];navigator.geolocation.getCurrentPosition(async u=>{for(const i of b){const x=`https://api.mapbox.com/directions/v5/mapbox/driving/${u.coords.longitude},${u.coords.latitude};${i.customer.longitude},${i.customer.latitude}?access_token=pk.eyJ1IjoiZWZ6ZWRlbDE2IiwiYSI6ImNscnhiN2NzYjBiNnQycW51Zmx3ajVjeG8ifQ.EM_vVs0ALH-nDkRQb-WSiA`;try{const v=(await(await fetch(x)).json()).routes[0].distance;r.push({...i,distance:v})}catch(f){console.error("Error:",f)}}r.sort((i,x)=>i.distance-x.distance),I(r)})})()},[]);const o=s.auth.user.role,a=(e,r,u)=>({id:e,header:r,accessorFn:i=>t.jsx(c,{style:{whiteSpace:"nowrap"},children:u(i)})}),l=[];o==="admin"&&l.unshift(a("customer_name","Pelanggan",e=>e.customer_name),a("items_count","Jumlah Barang",e=>e.items_count),a("status","Status",e=>t.jsx(j,{bg:e.status.includes("Belum")?"red":"green",c:"white",children:e.status})),a("courier_name","Kurir",e=>e.courier_name)),o==="kurir"&&l.unshift(a("customer_name","Pelanggan",e=>e.customer_name),a("items_count","Jumlah Barang",e=>e.items_count),a("status","Status",e=>t.jsx(j,{bg:e.status.includes("Belum")?"red":"green",c:"white",children:e.status}))),o==="pelanggan"&&l.unshift(a("items_count","Jumlah Barang",e=>e.items_count),a("status","Status",e=>t.jsx(j,{bg:e.status.includes("Belum")?"red":"green",c:"white",children:e.status})),a("courier_name","Kurir",e=>e.courier_name));const S=d.useMemo(()=>l,[o]),k=d.useMemo(()=>{let e=[...l];return e.push(a("updated_at","Diambil Pada",r=>r.updated_at)),e},[o]);return t.jsxs(z,{title:s.title,auth:s.auth.user,meta:s.meta,children:[t.jsx(R,{title:s.title,actions:s.auth.user.role==="kurir"&&t.jsxs(t.Fragment,{children:[t.jsx(C,{disabled:!s.orders.filter(({status:e})=>e==="Belum Diambil").length,radius:"xl",color:"red.5",h:40,leftSection:t.jsx(B,{}),display:{base:"none",xs:"block"},onClick:()=>g.get(route("schedule.routes")),children:"Rute Pengiriman"}),t.jsx(y,{disabled:!s.orders.filter(({status:e})=>e==="Belum Diambil").length,size:40,color:"red.5",radius:"xl",display:{base:"block",xs:"none"},onClick:()=>g.get(route("schedule.routes")),children:t.jsx(B,{})})]})}),t.jsxs(n,{defaultValue:"Belum Diambil",color:"red.5",radius:"xs",styles:{tab:{padding:16},panel:{marginTop:32}},children:[t.jsxs(n.List,{grow:!0,children:[t.jsx(n.Tab,{value:"Belum Diambil",leftSection:t.jsx(_,{size:40,variant:"light",radius:"xl",color:"red",children:t.jsx(M,{})}),rightSection:t.jsx(p,{color:"red",children:s.orders.filter(({status:e})=>e==="Belum Diambil").length}),children:t.jsx(c,{fw:500,size:"sm",children:"Belum Diambil"})}),t.jsx(n.Tab,{value:"Sudah Diambil",leftSection:t.jsx(_,{size:40,variant:"light",radius:"xl",color:"green",children:t.jsx(E,{})}),rightSection:t.jsx(p,{color:"green",children:s.orders.filter(({status:e})=>e==="Sudah Diambil").length}),children:t.jsx(c,{fw:500,size:"sm",children:"Sudah Diambil"})})]}),t.jsx(n.Panel,{value:"Belum Diambil",children:t.jsx(D,{columns:S,data:b.filter(({status:e})=>e==="Belum Diambil"),renderDetailPanel:({row:e})=>t.jsxs(h,{type:"ordered",children:[t.jsx(c,{mb:16,fw:500,children:"Nomor Resi"}),e.original.items.map(r=>t.jsx(h.Item,{children:r.receipt_number},r.receipt_number))]}),renderRowActions:s.auth.user.role==="kurir"&&(({row:e})=>t.jsxs(m,{position:"bottom-start",styles:{dropdown:{borderRadius:20},item:{borderRadius:20}},children:[t.jsx(m.Target,{children:t.jsx(y,{size:40,radius:"xl",variant:"subtle",color:"gray.9",c:"gray.9",children:t.jsx(w,{})})}),t.jsx(m.Dropdown,{children:t.jsx(m.Item,{leftSection:t.jsx(P,{}),onClick:()=>g.put(route("schedule.update",e.original.id)),children:"Diambil"})})]}))})}),t.jsx(n.Panel,{value:"Sudah Diambil",children:t.jsx(D,{columns:k,data:s.orders.filter(({status:e})=>e==="Sudah Diambil"),renderDetailPanel:({row:e})=>t.jsxs(h,{type:"ordered",children:[t.jsx(c,{mb:16,fw:500,children:"Nomor Resi"}),e.original.items.map(r=>t.jsx(h.Item,{children:r.receipt_number},r.receipt_number))]})})})]})]})};export{U as default};
