import{i as u,a4 as p,j as l,P as f}from"./app-C_DxjwWY.js";import{m as c,A as y}from"./mapbox-gl-ODp7-qlc.js";import{P as x}from"./PageHeader-OnnDhg3C.js";import{A as j}from"./AppLayout-HsdZrY7g.js";import"./Title-gs-8KFVt.js";c.accessToken="pk.eyJ1IjoiZWZ6ZWRlbDE2IiwiYSI6ImNscnhiN2NzYjBiNnQycW51Zmx3ajVjeG8ifQ.EM_vVs0ALH-nDkRQb-WSiA";const b=o=>{console.log(o.customers,"customers");const i=u.useRef(null),r=u.useRef(null),d=u.useRef([]);u.useEffect(()=>{r.current||!o.customers||o.customers.length===0||navigator.geolocation.getCurrentPosition(s=>{r.current=new c.Map({container:i.current,style:"mapbox://styles/mapbox/streets-v12",center:[s.coords.longitude,s.coords.latitude],zoom:16}).addControl(new c.FullscreenControl,"bottom-right").addControl(new c.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})).addControl(new c.NavigationControl,"top-left").addControl(new c.ScaleControl),r.current.on("load",()=>{[[s.coords.longitude,s.coords.latitude],...o.customers.map(e=>[e.longitude,e.latitude])].forEach((e,a)=>{const t=document.createElement("div");t.className=a===0?"marker start-marker":"marker",t.style.backgroundColor=a===0?"#FF6B6B":"#339AF0",t.style.width="30px",t.style.height="30px",t.style.borderRadius="50%",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.color="white",t.innerText=a;const g=new c.Marker(t).setLngLat(e).addTo(r.current);d.current.push(g)}),m()})})},[o.customers]);const m=()=>{const s=d.current.map(n=>n.getLngLat().toArray().join(","));p.get(`https://api.mapbox.com/directions/v5/mapbox/driving/${s.join(";")}?access_token=${c.accessToken}&overview=full&geometries=geojson`).then(n=>{const e=n.data;if(e.routes&&e.routes[0]){const a=e.routes[0].geometry;r.current.getSource("route")?r.current.getSource("route").setData({type:"Feature",properties:{},geometry:a}):(r.current.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:a}}),r.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#22B8CF","line-width":4,"line-dasharray":[2,2]}}))}else console.error("No routes returned from the Mapbox Directions API")}).catch(n=>console.error("Error:",n))};return l.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"20px"},children:l.jsx("div",{ref:i,style:{width:"100%",height:"100%",borderRadius:"20px"}})})},E=o=>{const[i,r]=u.useState({longitude:0,latitude:0}),[d,m]=u.useState([]);return u.useEffect(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{r({longitude:s.coords.longitude,latitude:s.coords.latitude})}):console.error("Geolocation is not supported by this browser.")},[]),u.useEffect(()=>{(async()=>{const n=[];if(i.longitude!==0&&i.latitude!==0)for(const e of o.customers){const a=`https://api.mapbox.com/directions/v5/mapbox/driving/${i.longitude},${i.latitude};${e.longitude},${e.latitude}?access_token=pk.eyJ1IjoiZWZ6ZWRlbDE2IiwiYSI6ImNscnhiN2NzYjBiNnQycW51Zmx3ajVjeG8ifQ.EM_vVs0ALH-nDkRQb-WSiA`;try{const h=(await(await fetch(a)).json()).routes[0].distance;n.push({...e,distance:h})}catch(t){console.error("Error:",t)}}n.sort((e,a)=>e.distance-a.distance),m(n)})()},[o.customers,i]),l.jsxs(j,{title:o.title,auth:o.auth.user,meta:o.meta,children:[l.jsx(x,{title:o.title}),l.jsx(f,{radius:20,withBorder:!0,p:32,children:l.jsx(y,{ratio:16/9,children:l.jsx(b,{customers:d})})})]})};export{E as default};
